jQuery(document).ready(function(s){var a={init:function(){a.toolTip(),a.upload_script(),a.start_import(),a.start_export.init(),a.accordion(),a.google.init()},toolTip:function(){var t=s("[rel~=tooltip]"),o=!1,a=!1;t.bind("mouseenter",function(){if(o=s(this),tip=o.attr("title"),a=s('<div id="tooltip"></div>'),!tip||""==tip)return!1;o.removeAttr("title"),a.css("opacity",0).html(tip).appendTo("body");var t=function(){s(window).width()<1.5*a.outerWidth()?a.css("max-width",s(window).width()/2):a.css("max-width",340);var t=o.offset().left+o.outerWidth()/2-a.outerWidth()/2,e=o.offset().top-a.outerHeight()-20;if(t<0?(t=o.offset().left+o.outerWidth()/2-20,a.addClass("left")):a.removeClass("left"),t+a.outerWidth()>s(window).width()?(t=o.offset().left-a.outerWidth()+o.outerWidth()/2+20,a.addClass("right")):a.removeClass("right"),e<0){e=o.offset().top+o.outerHeight();a.addClass("top")}else a.removeClass("top");a.css({left:t,top:e}).animate({top:"+=10",opacity:1},50)};t(),s(window).resize(t);var e=function(){a.animate({top:"-=10",opacity:0},50,function(){s(this).remove()}),o.attr("title",tip)};o.bind("mouseleave",e),a.bind("click",e)})},upload_script:function(){s("#fl-seo-data-csv").die("click").live("change",function(){s("#imageform").ajaxForm({target:"#csv_upload_result",beforeSubmit:function(){s("#drag-drop-area").addClass("upload-ongoing"),s("#csvloadbutton").hide()},success:function(){var t;(console.log("z"),s("#drag-drop-area").removeClass("upload-ongoing"),s("#plupload-upload-ui").slideToggle("slow"),s("#start-import").show(),a.accordion(),0<s('.fl_seo_data_csv_settings_page .third ul li:first-child[data-column*="taxonomy"]').length)&&(s(".fl_seo_data_csv_settings_page .notice-warning.taxonomy").show(),t=(t=s('#csv_xml_form fieldset[data-column="post-id"] legend').html()).replace("Post or Page","Taxonomy"),s('#csv_xml_form fieldset[data-column="post-id"] legend').html(t),t=(t=s('#csv_xml_form fieldset[data-column="post-type"] legend').html()).replace("Post","Taxonomy"),s('#csv_xml_form fieldset[data-column="post-type"] legend').html(t),s("#fsl-advance-fields").hide());a.start_draggable(),a.toolTip()},error:function(){console.log("d"),s("#drag-drop-area").removeClass("upload-ongoing"),s("#imageloadstatus").hide(),s("#csvloadbutton").show(),s("#start-import").hide()}}).submit()})},start_import:function(){s("body").on("click","#start-import",function(){if(s(this).hasClass("import-complete"))location.reload();else if(s("#csv-column-id").val()&&s("#csv-column-post-type").val()){var o=s(this);if(s("#import-button-wrap").hasClass("importing"))return alert("Import is currently in progress. Please wait..."),!1;s("#import-button-wrap").addClass("importing"),o.val("Working..."),s.ajax({type:"POST",url:_ajax.ajaxurl,data:{csv_file:o.attr("data-file"),records:s("#csv_upload_result .updated p strong").text(),offset:0,current:0,id_alias:a.helper.removeWhitespace(s("#csv-column-id").val()),post_type_alias:a.helper.removeWhitespace(s("#csv-column-post-type").val()),post_title_alias:a.helper.removeWhitespace(s("#csv-column-post-title").val()),post_slug_alias:a.helper.removeWhitespace(s("#csv-column-post-slug").val()),seo_title_alias:a.helper.removeWhitespace(s("#csv-column-seo-title").val()),description_alias:a.helper.removeWhitespace(s("#csv-column-description").val()),keywords_alias:a.helper.removeWhitespace(s("#csv-column-keywords").val()),focus_keywords_alias:a.helper.removeWhitespace(s("#csv-column-focus-keywords").val()),action:"fl_csv_import"},success:function(t){var e=s.parseJSON(t);203!=e.code&&""!=t||(o.val("Start Import"),alert("Invalid request. Please try again."),s("#import-button-wrap").removeClass("importing")),201==e.code&&(a.continue_import(e),o.val(e.message)),200==e.code&&(s("#csv_upload_result .updated p").html("All done! <strong>"+s("#csv_upload_result .updated p strong").text()+"</strong> entries have been imported!"),s(".csv-tree-wrap").slideToggle("slow"),o.val("Done"),s("#import-button-wrap").removeClass("importing"),o.addClass("import-complete"),a.after_import())},complete:function(t,e){200!=t.status&&(alert('This request takes too long to process, it is timed out by the server. If it should not be timed out, please contact administrator of this web site to increase "Connection Timeout".'),o.val("Start Import"))}})}else alert("Post/Page ID and post type are required. Please try again.");return!1})},continue_import:function(t){s.ajax({type:"POST",url:_ajax.ajaxurl,data:t,success:function(t){var e=s.parseJSON(t),o=s("#start-import");203!=e.code&&""!=t||(o.val("Start Import"),alert("Invalid request. Please try again.")),201==e.code&&(a.continue_import(e),o.val(e.message)),200==e.code&&(s("#csv_upload_result .updated p").html("All done! <strong>"+s("#csv_upload_result .updated p strong").text()+"</strong> entries have been imported!"),s(".csv-tree-wrap").slideToggle("slow"),s("#import-button-wrap").removeClass("importing"),o.val("Done"),o.addClass("import-complete"),a.after_import())},complete:function(t,e){200!=t.status&&(alert('This request takes too long to process, it is timed out by the server. If it should not be timed out, please contact administrator of this web site to increase "Connection Timeout".'),that.val("Start Import"))}})},after_import:function(){s("body").on("click","a#see-results-link",function(){s("div.import-results").slideToggle("slow")})},start_export:{init:function(){a.start_export.settings(),s("body").on("click","#start-export",function(){s(this);return data=s("form#yoast-csv-export").serialize(),s("#yoast-csv-export .submit").hasClass("exporting")?alert("Export curently in progress. Please wait..."):(s("#yoast-csv-export .submit").addClass("exporting"),s("#start-export span").text("Exporting...0%"),s.ajax({type:"GET",url:_ajax.ajaxurl,data:data,success:function(t){var e=s.parseJSON(t);203!=e.code&&""!=t||(s("#start-export span").text("Export to CSV"),s("#yoast-csv-export .submit").removeClass("exporting"),alert("Invalid request. Please try again.")),403==e.code&&(s("#start-export span").text("Export to CSV"),s("#yoast-csv-export .submit").removeClass("exporting"),alert(e.message)),201==e.code&&(a.continue_export(e),console.log(e),s("#start-export span").text(e.message)),200==e.code&&(s("#start-export span").text("Export to CSV"),s("#yoast-csv-export .submit").removeClass("exporting"),s("#yoast-csv-export p.submit").hide(),s("#smart-export-complete a.file-download").attr("href",e.url),s("#smart-export-complete a.google-link").attr("data-path",e.path),s("#smart-export-complete").show())},complete:function(t,e){200!=t.status&&(alert('This request takes too long to process, it is timed out by the server. If it should not be timed out, please contact administrator of this web site to increase "Connection Timeout".'),s("#start-export span").text("Export to CSV"),s("#yoast-csv-export .submit").removeClass("exporting"))}})),!1})},settings:function(){s('input[name*="seo_export_from"]').datepicker({dateFormat:"yy-mm-dd",onClose:function(t){s('input[name*="seo_export_to"]').datepicker("option","minDate",t)}}),s('input[name*="seo_export_to"]').datepicker({dateFormat:"yy-mm-dd",onClose:function(t){s('input[name*="seo_export_from"]').datepicker("option","maxDate",t)}}),s('#yoast-csv-export input[type="radio"]').on("click",function(){"post"==s(this).attr("data-type")?s(".fsl-export-settings").show("slow"):s(".fsl-export-settings").hide("slow")})}},continue_export:function(t){s.ajax({type:"GET",url:_ajax.ajaxurl,data:t,success:function(t){var e=s.parseJSON(t),o=s("#start-export");203!=e.code&&""!=t||(o.val("Export to CSV"),s("#yoast-csv-export .submit").removeClass("exporting"),alert("Invalid request. Please try again.")),201==e.code&&(console.log(e),s("#start-export span").text(e.message),e.completion_status<100&&a.continue_export(e)),200==e.code&&(s("#start-export span").text("Export to CSV"),s("#yoast-csv-export .submit").removeClass("exporting"),s("#yoast-csv-export p.submit").hide(),s("#smart-export-complete a.file-download").attr("href",e.url),s("#smart-export-complete a.google-link").attr("data-path",e.path),s("#smart-export-complete").show())},complete:function(t,e){200!=t.status&&(alert('This request takes too long to process, it is timed out by the server. If it should not be timed out, please contact administrator of this web site to increase "Connection Timeout".'),s("#start-export span").text("Export to CSV"),s("#yoast-csv-export .submit").removeClass("exporting"))}})},start_draggable:function(){s(".fl_seo_data_csv_settings_page .draggable").draggable({revert:!0}),s(".fl_seo_data_csv_settings_page .droppable").droppable({drop:function(t,e){console.log(s(e.draggable).text()),s(this).addClass("ui-state-highlight").val(s(e.draggable).text())}})},accordion:function(){0<s(".od-accordion").length&&(s(".od-accordion").find(".accordion-toggle").click(function(){s(this).nextAll(".accordion-content").eq(0).slideToggle("fast",function(){s(this).hasClass("collapse")?s(this).removeClass("collapse"):s(this).addClass("collapse")}),s(".accordion-content").not(s(this).nextAll(".accordion-content").eq(0)).slideUp("fast")}),s(".od-accordion .accordion-toggle").click(function(){s(".od-accordion .accordion-toggle").not(s(this)).removeClass("collapse"),s(this).hasClass("collapse")?s(this).removeClass("collapse"):s(this).addClass("collapse")}))},google:{init:function(){s("body").on("click","div#smart-export-complete a.google-link",function(t){var o=s(this);return o.hasClass("authenticating")?(alert("Hang on a second. Authentication is still ongoing."),!1):(o.hasClass("enable")||(o.addClass("authenticating"),s("div#smart-export-complete a.google-link strong").text("Authenticating..."),s.ajax({type:"POST",url:_ajax.ajaxurl,data:{action:"is_google_authenticated",file:o.attr("data-path")},success:function(t){200==t.code&&(console.log(t),console.log("Begin export..."),a.google.export()),403==t.code&&(o.removeClass("authenticating"),s("div#smart-export-complete a.google-link strong").text("Authenticate Google Drive"),o.addClass("enable"),o.attr("target","_blank"),o.attr("href",t.next))},complete:function(t,e){200!=t.status&&(alert('This request takes too long to process, it is timed out by the server. If it should not be timed out, please contact administrator of this web site to increase "Connection Timeout".'),o.removeClass("authenticating"),s("div#smart-export-complete a.google-link strong").text("Edit in Google Sheet"))}})),!!o.hasClass("enable"))}),null!=a.helper.getQueryString("path")&&s("div#smart-export-complete a.google-link").trigger("click")},export:function(){var o=s("div#smart-export-complete a.google-link");s.ajax({type:"POST",url:_ajax.ajaxurl,data:{action:"export_to_drive",path:o.attr("data-path")},success:function(t){200==t.code&&(console.log(t),o.removeClass("authenticating"),o.addClass("enable"),o.attr("href",t.file),o.attr("target","_newtab"),s("div#smart-export-complete a.google-link strong").text("Edit in Google Sheet"),window.open(t.file,"_newtab"),s("div#smart-export-complete").after('<div class="updated" style="margin-top: 20px;"><p>Your file is ready for editing: <br><a class="google-sheet-link" href="'+t.file+'" target="_newtab">'+t.file+"</a></p></div>")),t.code},complete:function(t,e){200!=t.status&&(alert('This request takes too long to process, it is timed out by the server. If it should not be timed out, please contact administrator of this web site to increase "Connection Timeout".'),o.removeClass("authenticating"),s("div#smart-export-complete a.google-link strong").text("Edit in Google Sheet"))}})}},helper:{removeWhitespace:function(t){return t.trim(),t},getQueryString:function(t,e){var o=e||window.location.href,a=new RegExp("[?&]"+t+"=([^&#]*)","i").exec(o);return a?a[1]:null}}};a.init()});